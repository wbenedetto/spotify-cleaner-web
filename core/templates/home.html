<!DOCTYPE html>
<html>
  {{ playlists|json_script:"playlist-data" }}

<head>
  <title>Your Playlists</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .main-bottom::-webkit-scrollbar {
      display: none;
    }

    .main-bottom {
      -ms-overflow-style: none;  /* IE and Edge */
      scrollbar-width: none;     /* Firefox */
    }

    body {
      margin: 0;
      background-color: #121212;
      color: white;
      font-family: sans-serif;
      display: flex;
    }

    .sidebar {
      width: 300px;
      height: 100vh;
      background-color: #000;
      padding: 20px;
      overflow-y: auto;
      border-right: 1px solid #333;
    }

    .playlist-entry {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      cursor: pointer;
      padding: 5px;
      border-radius: 5px;
    }

    .playlist-entry:hover, .playlist-entry.selected {
      background-color: #1a1a1a;
    }

    .playlist-entry img {
      width: 60px;
      height: 60px;
      margin-right: 10px;
      border-radius: 4px;
      object-fit: cover;
    }

    .playlist-info {
      display: flex;
      flex-direction: column;
    }

    .playlist-info span:first-child {
      font-weight: bold;
      font-size: 17px;
      margin-bottom: 7px;
    }

    .playlist-info span:last-child {
      font-size: 12px;
      color: #b3b3b3;
    }

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden; /* prevent body scroll */
    }

    .main-top {
      padding: 30px;
      flex-shrink: 0;
    }

    .main-bottom {
      flex: 1;
      overflow-y: auto;
      padding: 0 40px 40px 40px;
    }

    .main img {
      width: 200px;
      height: 200px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .main h1 {
      margin: 0 0 10px;
      font-size: 28px;
    }

    .main p {
      color: #b3b3b3;
      font-size: 14px;
    }

    .main button {
      margin-top: 20px;
      padding: 10px 10px;
      background-color: #1db954;
      border: none;
      color: white;
      font-size: 14px;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div class="sidebar">
  <h2 style="font-size: 20px; margin-bottom: 15px;">Your Playlists</h2>

  {% for playlist in playlists %}
    <div class="playlist-entry" data-index="{{ forloop.counter0 }}" id="playlist-{{ forloop.counter0 }}">
      {% if playlist.image_url %}
        <img src="{{ playlist.image_url }}" alt="Cover">
      {% else %}
        <div style="width: 48px; height: 48px; background: #555; margin-right: 10px;"></div>
      {% endif %}
      <div class="playlist-info">
        <span>{{ playlist.name }}</span>
        <span>{{ playlist.tracks }} Tracks</span>
      </div>
    </div>
  {% endfor %}
</div>

<div class="main">
  <div class="main-top" id="mainTopContent">
    <p>Select a playlist from the sidebar to view details.</p>
  </div>
  <div class="main-bottom" id="mainBottomContent">
  </div>
</div>


<script>
  const playlists = JSON.parse(document.getElementById('playlist-data').textContent);


  function selectPlaylist(index) {
  document.querySelectorAll('.playlist-entry').forEach(el => el.classList.remove('selected'));
  document.getElementById(`playlist-${index}`).classList.add('selected');

  const playlist = playlists[index];
  const top = document.getElementById("mainTopContent");
  const bottom = document.getElementById("mainBottomContent");

  // FIRST: Build the song list
  let songList = `
  <div style="display: grid; grid-template-columns: 30px 2fr 2fr; font-weight: bold; margin-bottom: 10px; padding: 5px 0; border-bottom: 1px solid #333;">
    <div>#</div>
    <div>Title</div>
    <div>Album</div>
  </div>
`;

playlist.songs.forEach((song, i) => {
  songList += `
    <div style="display: grid; grid-template-columns: 30px 2fr 2fr; align-items: center; padding: 6px 0; border-bottom: 1px solid #1e1e1e;">
      <div style="color:#b3b3b3;">${i + 1}</div>
      <div>
        <div>${song.name}</div>
        <div style="color:#b3b3b3; font-size: 12px;">${song.artist}</div>
      </div>
      <div style="color:#b3b3b3; font-zise: 15px;">${song.album || ''}</div>
    </div>
  `;
});


  // THEN: Inject the top panel HTML
  top.innerHTML = `
    <div style="display: flex; align-items: center; gap: 20px;">
      <img src="${playlist.image_url || ''}" alt="Cover" style="width: 200px; height: 200px; border-radius: 10px;">
      <div>
        <h1 style="font-size: 60px; padding-bottom: 2px">${playlist.name}</h1>
        <p style="font-size: 18px">${playlist.tracks} Tracks</p>
        <form method="post" action="/organize/">
          <input type="hidden" name="playlist_uri" value="${playlist.uri}">
          <button type="submit"><i class="fa-solid fa-arrows-rotate"></i> Organize Playlist</button>
        </form>
      </div>
    </div>
    <hr style="height:2px;border-width:0;color:#343434;background-color:#343434">
  `;

  // Add songs to bottom section
  bottom.innerHTML = songList;
}



  document.querySelectorAll('.playlist-entry').forEach(el => {
  el.addEventListener('click', () => {
    const index = el.getAttribute('data-index');
    selectPlaylist(index);
  });
});

if (playlists.length > 0) {
  selectPlaylist(0);
}


</script>



</body>
</html>
